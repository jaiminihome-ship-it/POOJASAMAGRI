<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pooja Selection - Sequence Pro</title>
  <style>
    :root { --main: #FF9800; --dark: #2D3436; --light: #f4f7f6; }
    body { font-family: system-ui; background: var(--light); margin: 0; padding: 15px; padding-bottom: 100px; }
    
    header { text-align: center; margin-bottom: 20px; padding-top: 10px; }
    h2 { color: var(--dark); font-size: 22px; }

    /* ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ï‡§æ ‡§®‡§Ø‡§æ ‡§≤‡•á‡§Ü‡§â‡§ü */
    .card { 
      background: white; border-radius: 15px; padding: 12px 15px; margin-bottom: 10px; 
      display: flex; align-items: center; gap: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.05);
      transition: 0.3s; border: 2px solid transparent;
    }
    .card.selected { border-color: var(--main); background: #FFF3E0; }

    input[type="checkbox"] { width: 24px; height: 24px; accent-color: var(--main); cursor: pointer; }
    label { flex-grow: 1; font-weight: 700; color: var(--dark); cursor: pointer; }

    /* ‡§ï‡•ç‡§∞‡§Æ ‡§¨‡§¶‡§≤‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§¨‡§ü‡§® */
    .sort-controls { display: flex; flex-direction: column; gap: 4px; }
    .btn-sort { 
      background: #eee; border: none; border-radius: 5px; padding: 5px; 
      font-size: 12px; cursor: pointer; color: #555; 
    }
    .btn-sort:active { background: var(--main); color: white; }

    .btn-next { 
      position: fixed; bottom: 20px; left: 15px; right: 15px; 
      background: var(--main); color: white; padding: 18px; border: none; 
      border-radius: 15px; font-weight: bold; font-size: 18px; box-shadow: 0 5px 15px rgba(255,152,0,0.3);
    }
  </style>
</head>
<body>

<header><h2>üôè ‡§™‡•Ç‡§ú‡§æ ‡§ï‡§æ ‡§ï‡•ç‡§∞‡§Æ ‡§§‡§Ø ‡§ï‡§∞‡•á‡§Ç</h2></header>

<div id="list">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>

<button class="btn-next" onclick="save()">Next: ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§¶‡•á‡§ñ‡•á‡§Ç ‚Üí</button>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbyhXVfu7WVAs2pQQLyH3lkkO3ZG-rmbqTmyygjqH8XeWyQPNgqx49whCIsa8WttKRZ4/exec";
  let poojaData = [];

  // ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡§æ
  fetch(API_URL).then(r => r.json()).then(data => {
    const unique = [...new Set(data.map(x => x.pooja?.trim()))].filter(Boolean);
    // ‡§∂‡•Å‡§∞‡•Ç ‡§Æ‡•á‡§Ç ‡§á‡§∏‡•á ‡§ë‡§¨‡•ç‡§ú‡•á‡§ï‡•ç‡§ü‡•ç‡§∏ ‡§ï‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡•á‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§ï‡•ç‡§∞‡§Æ (Index) ‡§ü‡•ç‡§∞‡•à‡§ï ‡§π‡•ã ‡§∏‡§ï‡•á
    poojaData = unique.map(p => ({ name: p, checked: false }));
    renderList();
  });

  function renderList() {
    const box = document.getElementById("list");
    box.innerHTML = "";
    
    poojaData.forEach((p, i) => {
      box.innerHTML += `
        <div class="card ${p.checked ? 'selected' : ''}">
          <input type="checkbox" id="p${i}" ${p.checked ? 'checked' : ''} onchange="togglePooja(${i})">
          <label for="p${i}">${p.name}</label>
          
          <div class="sort-controls">
            <button class="btn-sort" onclick="moveUp(${i})">üîº</button>
            <button class="btn-sort" onclick="moveDown(${i})">üîΩ</button>
          </div>
        </div>`;
    });
  }

  function togglePooja(index) {
    poojaData[index].checked = !poojaData[index].checked;
    renderList();
  }

  // ‡§ï‡•ç‡§∞‡§Æ ‡§ä‡§™‡§∞ ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§≤‡•â‡§ú‡§ø‡§ï
  function moveUp(index) {
    if (index > 0) {
      const temp = poojaData[index];
      poojaData[index] = poojaData[index - 1];
      poojaData[index - 1] = temp;
      renderList();
    }
  }

  // ‡§ï‡•ç‡§∞‡§Æ ‡§®‡•Ä‡§ö‡•á ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§≤‡•â‡§ú‡§ø‡§ï
  function moveDown(index) {
    if (index < poojaData.length - 1) {
      const temp = poojaData[index];
      poojaData[index] = poojaData[index + 1];
      poojaData[index + 1] = temp;
      renderList();
    }
  }

  function save() {
    // ‡§∏‡§ø‡§∞‡•ç‡§´‡§º ‡§ö‡•Å‡§®‡•Ä ‡§π‡•Å‡§à ‡§™‡•Ç‡§ú‡§æ ‡§ï‡•ã ‡§â‡§∏‡•Ä ‡§ï‡•ç‡§∞‡§Æ ‡§Æ‡•á‡§Ç ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§Ç
    const selected = poojaData.filter(p => p.checked).map(p => p.name);
    
    if(selected.length === 0) return alert("‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§è‡§ï ‡§™‡•Ç‡§ú‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç!");
    
    localStorage.setItem("selected_poojas", JSON.stringify(selected));
    window.location.href = "samagri.html";
  }
</script>
</body>
</html>
