<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cloud Templates - Vedic Pro</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root { --main: #FF6F00; --dark: #2D3436; --bg: #f0f2f5; }
    body { font-family: 'Noto Sans Devanagari', sans-serif; background: var(--bg); margin: 0; }
    
    header { 
      background: var(--dark); color: white; padding: 25px; text-align: center; 
      border-bottom: 5px solid var(--main); border-radius: 0 0 20px 20px;
    }

    .container { padding: 15px; max-width: 600px; margin: auto; }

    /* ‡§ï‡•ç‡§≤‡§æ‡§â‡§° ‡§ï‡§æ‡§∞‡•ç‡§° ‡§∏‡•ç‡§ü‡§æ‡§á‡§≤ */
    .temp-card { 
      background: white; border-radius: 15px; padding: 20px; margin-bottom: 15px; 
      box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-left: 10px solid var(--main);
      animation: fadeIn 0.5s ease;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .temp-name { font-size: 22px; font-weight: 800; color: var(--dark); }
    .temp-meta { font-size: 14px; color: #666; margin: 8px 0; font-weight: 600; }
    .temp-poojas { color: var(--main); font-size: 15px; font-weight: 700; margin-bottom: 15px; }

    .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    button { padding: 12px; border: none; border-radius: 10px; font-weight: 800; cursor: pointer; font-size: 15px; }
    .btn-load { background: var(--dark); color: white; }
    .btn-view { background: #e3f2fd; color: #1976d2; }

    .loading { text-align: center; padding: 50px; color: var(--main); font-weight: 700; }
  </style>
</head>
<body>

<header>
  <h2 style="margin:0;">‚òÅÔ∏è ‡§ï‡•ç‡§≤‡§æ‡§â‡§° ‡§ü‡•á‡§Æ‡•ç‡§™‡§≤‡•á‡§ü‡•ç‡§∏</h2>
  <p style="margin:5px 0 0; opacity:0.8;">‡§∏‡•Ä‡§ß‡•á ‡§Ü‡§™‡§ï‡•Ä Google Sheet ‡§∏‡•á ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§</p>
</header>

<div class="container" id="list">
  <div class="loading">‡§¨‡§æ‡§¶‡§≤‡•ã‡§Ç ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§Ü ‡§∞‡§π‡§æ ‡§π‡•à... ‚òÅÔ∏è</div>
</div>

<script>
  // ‡§Ü‡§™‡§ï‡•Ä Apps Script URL
  const API_URL = "https://script.google.com/macros/s/AKfycbyhXVfu7WVAs2pQQLyH3lkkO3ZG-rmbqTmyygjqH8XeWyQPNgqx49whCIsa8WttKRZ4/exec";
  let cloudTemplates = [];

  async function fetchCloudTemplates() {
    try {
      // "getTemplates" ‡§è‡§ï‡•ç‡§∂‡§® ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ï‡•ç‡§≤‡§æ‡§â‡§° ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§Æ‡§Ç‡§ó‡§æ‡§®‡§æ
      const res = await fetch(`${API_URL}?action=getTemplates`);
      cloudTemplates = await res.json();
      renderTemplates();
    } catch (e) {
      document.getElementById("list").innerHTML = "<div class='loading' style='color:red;'>‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§è‡§∞‡§∞! ‡§ï‡•É‡§™‡§Ø‡§æ 'Anyone' ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§</div>";
    }
  }

  function renderTemplates() {
    const container = document.getElementById("list");
    if(cloudTemplates.length === 0) {
      container.innerHTML = "<div class='loading'>‡§ï‡•ã‡§à ‡§ü‡•á‡§Æ‡•ç‡§™‡§≤‡•á‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§</div>";
      return;
    }

    container.innerHTML = "";
    cloudTemplates.reverse().forEach((t, i) => { // ‡§≤‡•á‡§ü‡•á‡§∏‡•ç‡§ü ‡§ü‡•á‡§Æ‡•ç‡§™‡§≤‡•á‡§ü ‡§ä‡§™‡§∞ ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Å
      container.innerHTML += `
        <div class="temp-card">
          <div class="temp-name">‡§Ø‡§ú‡§Æ‡§æ‡§®: ${t.name}</div>
          <div class="temp-meta">üìÖ ‡§§‡§æ‡§∞‡•Ä‡§ñ: ${t.date}</div>
          <div class="temp-poojas">üïâÔ∏è ${t.poojas.join(", ")}</div>
          <div class="actions">
            <button class="btn-load" onclick="loadTemplate(${i})">Edit & Print ‚úçÔ∏è</button>
            <button class="btn-view" onclick="alert('ID: ' + cloudTemplates[${i}].id)">Details ‚ÑπÔ∏è</button>
          </div>
        </div>
      `;
    });
  }

  function loadTemplate(idx) {
    const t = cloudTemplates[idx];
    
    // ‡§≤‡•ã‡§ï‡§≤ ‡§∏‡•ç‡§ü‡•ã‡§∞‡•á‡§ú ‡§Æ‡•á‡§Ç ‡§°‡•á‡§ü‡§æ ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§Ö‡§®‡•ç‡§Ø ‡§™‡•á‡§ú‡•á‡§ú ‡§á‡§∏‡•á ‡§á‡§∏‡•ç‡§§‡•á‡§Æ‡§æ‡§≤ ‡§ï‡§∞ ‡§∏‡§ï‡•á‡§Ç
    localStorage.setItem("pooja_meta", JSON.stringify({ yajman: t.name, date: t.date }));
    localStorage.setItem("selected_poojas", JSON.stringify(t.poojas));
    localStorage.setItem("final_samagri", JSON.stringify(t.samagri)); // ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ ‡§î‡§∞ ‡§á‡§ï‡§æ‡§à ‡§≠‡•Ä ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§
    
    window.location.href = "samagri.html";
  }

  fetchCloudTemplates();
</script>
</body>
</html>
